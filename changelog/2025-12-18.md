# 2025-12-18

- 初始化：新增 changelog 目录，用于记录后续变更。

- 前端：补齐 DataChannel 聊天发送（Send 按钮 + Enter），未建立连接时给出提示。
- 前端：成员列表渲染优化（胶囊按钮、禁用自己、点击自动填入 Remote）。
- 前端：状态机与按钮状态统一（Join/Leave 文案切换、输入框启用禁用逻辑）。
- 前端：信令与通话流程修复（offer 到达后自动进入 calling，区分手动关闭与异常断开）。
- 前端：资源清理与可重复使用（Hangup 不再停止本地轨道；新增 Leave 清理 PC/WS/媒体；屏幕共享与再次呼叫兼容）。

- 后端：信令 Hub 支持通过 `Options` 注入 Origin 校验配置（`AllowedOrigins`/`AllowAllOrigins`），避免包内隐式全局 env 状态。
- 后端：入口统一解析 `WS_ALLOWED_ORIGINS` 并注入 Hub；服务启动改用 `ServeMux` + `http.Server`，避免使用默认全局路由。
- 后端：`writePump` 写失败时主动关闭连接，触发读循环退出并完成资源清理。
- 后端：升级失败日志补充 `path`；连接结束时关闭 `send` 通道以退出写协程；`removeClient` 调整为不关闭通道，避免 `leave` 后同连接再次 `join` 引发 panic。
- 后端：支持可选心跳消息 `ping`，并以 `pong` 非阻塞回应，用于学习“保活”概念。

- 文档：同步更新 `docs/signaling.md` 中的 Hub 结构与 `writePump` 示例代码。
- 文档：更新 `README.md` 配置章节（补充 `ADDR`、`WS_ALLOWED_ORIGINS="*"` 用法），并同步更新 `ROADMAP.md` 阶段 1 后端任务勾选状态。

- 文档：同步补充 `docs/guide.md` 中 Hub 的 Origin 校验配置说明（`allowedOrigins`/`allowAllOrigins`），强调由入口解析 `WS_ALLOWED_ORIGINS` 并通过 `signal.Options` 注入。
- 前端：WebSocket 信令连接增加简单心跳（定时发送 `ping`，在关闭/离开时清理定时器）。
- 前端：收到 `room_members` 且 `Remote ID` 为空时，自动填入第一个非自己的成员作为“可呼叫对象提示”。
- 文档：补充 `ping/pong` 消息类型与处理说明，并在 `ROADMAP.md` 中标记心跳机制已完成。
